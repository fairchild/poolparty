#!/usr/bin/env ruby
require 'rubygems'
$:.unshift(File.join(File.dirname(__FILE__), "..", "lib"))

require "poolparty"
if ENV['POOL_SPEC']
  require ENV["POOL_SPEC"]
else
  $:.unshift '/etc/poolparty'
  require "clouds.rb"  #this should load the /etc/poolparty/clouds.rb or ./clouds.rb
end

list_type = ARGV.shift || "ip"

# cld = clouds[ ::File.read('/etc/poolparty/cloud_name').to_sym ]
conditions= {:status=>'running', :keypair=>my_cloud.key.basename}
inst_array = my_cloud.describe_instances.select_with_hash(conditions)

puts inst_array.collect{|n| n[list_type] || n[list_type.to_sym]}.join("\t")